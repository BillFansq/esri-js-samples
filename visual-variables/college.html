<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
<title>U.S. College Attendance (2015)</title>
<link rel="stylesheet" href="http://jsdev.arcgis.com/3.15/esri/css/esri.css">
<link rel="stylesheet" href="http://jsdev.arcgis.com/3.15/dijit/themes/claro/claro.css">
<style>
  html, body, #map {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
  }
  #info {
    background-color: #000;
    z-index: 92;
    left: 0;
    bottom: 0;
    position: absolute;  
    padding: 10px;
    font-family: Segoe UI;
    color: #fff;
    width: 200px;
  }
</style>
<script src="http://jsdev.arcgis.com/3.15/"></script>
<script>
var map, collegeLyr, legend, renderer;
  require([
    "esri/map",
    "esri/layers/FeatureLayer",
    "esri/symbols/SimpleMarkerSymbol",
    "esri/symbols/SimpleLineSymbol",
    "esri/Color",
    "esri/renderers/UniqueValueRenderer",
    "esri/dijit/Legend",
    "esri/dijit/PopupTemplate",
    "dojo/domReady!"
  ], function(Map, FeatureLayer, SimpleMarkerSymbol, SimpleLineSymbol, Color, UniqueValueRenderer, Legend, PopupTemplate
) {
  var url = "http://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/us_county_educational_attainment_pop/FeatureServer/0";      

  map = new Map("map", {
    zoom: 5,
    center: [-100, 40],
    basemap: "gray"
  });
      
  var collegePopup = new PopupTemplate({
    title: "{COUNTY}, {STATE}",
    description: "<b>{ATT_COL}</b> adults (ages 25+) in {COUNTY} have attended at least some college in their lifetime. <b>{NO_COL}</b> adults in the same age group have never attended any college courses.",
    fieldInfos: [{
      fieldName: "ATE_COL_DOM_PER",
      label: "Majority group percentage",
      format: { places: 0, digitSeparator: true }  
    }, {
      fieldName: "EDUCBASECY",
      label: "total adult population",
      format: { places: 0, digitSeparator: true }  
    }, {
      fieldName: "NO_COL",
      label: "Never attended any college",
      format: { places: 0, digitSeparator: true }  
    }, {
      fieldName: "ATT_COL",
      label: "Adults who attended at least some college",
      format: { places: 0, digitSeparator: true }  
    }],
    mediaInfos: [{
      title: "Adults who attended college versus those who didn't",
      type: "piechart",
      value: {
        fields: ["ATT_COL", "NO_COL"]
      }
    }]
  });
      
  collegeLyr = new FeatureLayer(url, {
    outFields: ["ATT_COL_DOM", "ATE_COL_DOM_PER", "COL_ATT_GAP", "EDUCBASECY", "NO_COL", "ATT_COL", "COUNTY", "STATE"],
    infoTemplate: collegePopup
  });
      
  var defaultSym = new SimpleMarkerSymbol().setOutline(new SimpleLineSymbol().setWidth(0.3).setColor(new Color([128,128,128,0.5])));
  var attColSym = new SimpleMarkerSymbol().setColor(new Color("#4daf4a")).setOutline(new SimpleLineSymbol().setWidth(0.3).setColor(new Color([128,128,128,0.5])));
  var noColSym = new SimpleMarkerSymbol().setColor(new Color("#984ea3")).setOutline(new SimpleLineSymbol().setWidth(0.3).setColor(new Color([128,128,128,0.5])));
      
  renderer = new UniqueValueRenderer(defaultSym, "ATT_COL_DOM");
  renderer.addValue({
    value: "Population 25+ that attended college",
    label: "Majority of adults attended at least some college",
    symbol: attColSym
  });
  renderer.addValue({
    value: "Population 25+ that never attended college",
    label: "Majority of adults never attended college",
    symbol: noColSym
  });
  
  var sizeVisVar = {
    type: "sizeInfo",
    field: "EDUCBASECY",
    minDataValue: 10000,
    maxDataValue: 1000000,
    minSize: {
      type: "sizeInfo",
      expression: "view.scale",
      stops: [
        { value: 250000000, size: 6 },
        { value: 6000000, size: 6 },
        { value: 1000000, size: 4 },
        { value: 200000, size: 2 },
        { value: 1000, size: 2 }    
      ]
    },
    maxSize: {
      type: "sizeInfo",
      expression: "view.scale",
      stops: [
        { value: 250000000, size: 50 },
        { value: 6000000, size: 50 },
        { value: 1000000, size: 40 },
        { value: 200000, size: 20 },
        { value: 1000, size: 10 }    
      ] 
    }
  };      
  var opacityVisVar = {
    type: "opacityInfo",
    field: "ATE_COL_DOM_PER",
    stops: [
      { value: 55, opacity: 0.1 },
      { value: 70, opacity: 1 }    
    ]
  }; 
  renderer.setVisualVariables([sizeVisVar, opacityVisVar]);
  collegeLyr.setRenderer(renderer);
     
  map.addLayer(collegeLyr);
      
  map.on("load", function(){
    legend = new Legend({
      map: map,
      layerInfos: [
        {
          layer: collegeLyr,
          title: "U.S. Counties by adult population (25+) and whether the majority of adults attended college",
          defaultSymbol: false
        }
      ]
    }, "legendDiv");
    legend.startup();   
  });      
});
</script>
</head>
<body class="claro">
    <div id="map"></div>
    <div id="info"><div id="legendDiv"></div></div>
</body>
</html>